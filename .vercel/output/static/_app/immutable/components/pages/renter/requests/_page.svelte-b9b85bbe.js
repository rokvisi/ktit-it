import{S as pe,i as de,s as me,k as y,q as E,a as q,l as Q,m as I,r as C,h as p,c as A,n as w,b as v,D as $,t as k,d as G,f as b,E as _e,g as J,a8 as he,a9 as $e,A as L,e as S,v as R,w as D,x as P,y as H,a1 as te,u as F,a7 as ve}from"../../../../chunks/index-055277d2.js";import{S as be,c as X,w as se,x as ge}from"../../../../chunks/logger-312c5320.js";import"../../../../chunks/preload-helper-aa6bc0ce.js";import{r as ke}from"../../../../chunks/index-ca34a969.js";import{Q as Oe,u as we}from"../../../../chunks/useQueryClient-977cb811.js";import{_ as ye}from"../../../../chunks/index-default-728b491c.js";import{l as Qe,A as Ee,C as ce,P as Ce,H as Ie}from"../../../../chunks/Header-6fed1335.js";import{U as fe}from"../../../../chunks/UserIcon-2d31419b.js";import{C as qe}from"../../../../chunks/ActionIcons-b3098cee.js";import{A as re}from"../../../../chunks/ActionButton-d85b6509.js";class Ae extends be{constructor(e,t){super(),this.client=e,this.queries=[],this.result=[],this.observers=[],this.observersMap={},t&&this.setQueries(t)}onSubscribe(){this.listeners.length===1&&this.observers.forEach(e=>{e.subscribe(t=>{this.onUpdate(e,t)})})}onUnsubscribe(){this.listeners.length||this.destroy()}destroy(){this.listeners=[],this.observers.forEach(e=>{e.destroy()})}setQueries(e,t){this.queries=e,this.updateObservers(t)}getCurrentResult(){return this.result}getOptimisticResult(e){return this.findMatchingObservers(e).map(t=>t.observer.getOptimisticResult(t.defaultedQueryOptions))}findMatchingObservers(e){const t=this.observers,r=e.map(c=>this.client.defaultQueryObserverOptions(c)),n=r.flatMap(c=>{const _=t.find(f=>f.options.queryHash===c.queryHash);return _!=null?[{defaultedQueryOptions:c,observer:_}]:[]}),l=n.map(c=>c.defaultedQueryOptions.queryHash),i=r.filter(c=>!l.includes(c.queryHash)),a=t.filter(c=>!n.some(_=>_.observer===c)),s=i.map((c,_)=>{if(c.keepPreviousData){const f=a[_];if(f!==void 0)return{defaultedQueryOptions:c,observer:f}}return{defaultedQueryOptions:c,observer:this.getObserver(c)}}),o=(c,_)=>r.indexOf(c.defaultedQueryOptions)-r.indexOf(_.defaultedQueryOptions);return n.concat(s).sort(o)}getObserver(e){const t=this.client.defaultQueryObserverOptions(e),r=this.observersMap[t.queryHash];return r!=null?r:new Oe(this.client,t)}updateObservers(e){X.batch(()=>{const t=this.observers,r=this.findMatchingObservers(this.queries);r.forEach(s=>s.observer.setOptions(s.defaultedQueryOptions,e));const n=r.map(s=>s.observer),l=Object.fromEntries(n.map(s=>[s.options.queryHash,s])),i=n.map(s=>s.getCurrentResult()),a=n.some((s,o)=>s!==t[o]);t.length===n.length&&!a||(this.observers=n,this.observersMap=l,this.result=i,this.hasListeners()&&(se(t,n).forEach(s=>{s.destroy()}),se(n,t).forEach(s=>{s.subscribe(o=>{this.onUpdate(s,o)})}),this.notify()))})}onUpdate(e,t){const r=this.observers.indexOf(e);r!==-1&&(this.result=ge(this.result,r,t),this.notify())}notify(){X.batch(()=>{this.listeners.forEach(e=>{e(this.result)})})}}function Me(u){const e=we();function t(a){return a.map(s=>{const o=e.defaultQueryObserverOptions(s);return o.optimisticResults=!0,o})}const r=t(u),n=new Ae(e,r),{subscribe:l}=ke(n.getCurrentResult(),a=>n.subscribe(X.batchCalls(a)));return{subscribe:l,setQueries:a=>{if(n.hasListeners()){const s=t(a);n.setQueries(s,{listeners:!1})}}}}function ne(u,e,t){const r=u.slice();return r[9]=e[t],r}function le(u,e,t){const r=u.slice();return r[12]=e[t],r}function Re(u){let e,t=[],r=new Map,n,l=u[0];const i=a=>a[9].id;for(let a=0;a<l.length;a+=1){let s=ne(u,l,a),o=i(s);r.set(o,t[a]=ue(o,s))}return{c(){e=y("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=Q(a,"DIV",{class:!0});var s=I(e);for(let o=0;o<t.length;o+=1)t[o].l(s);s.forEach(p),this.h()},h(){w(e,"class","flex flex-col gap-8 mb-10")},m(a,s){v(a,e,s);for(let o=0;o<t.length;o+=1)t[o].m(e,null);n=!0},p(a,s){s&11&&(l=a[0],J(),t=he(t,s,i,1,a,l,r,e,$e,ue,null,ne),G())},i(a){if(!n){for(let s=0;s<l.length;s+=1)b(t[s]);n=!0}},o(a){for(let s=0;s<t.length;s+=1)k(t[s]);n=!1},d(a){a&&p(e);for(let s=0;s<t.length;s+=1)t[s].d()}}}function De(u){let e,t;return{c(){e=y("p"),t=E("\u0160iuo metu u\u017Esakym\u0173 n\u0117ra!")},l(r){e=Q(r,"P",{});var n=I(e);t=C(n,"\u0160iuo metu u\u017Esakym\u0173 n\u0117ra!"),n.forEach(p)},m(r,n){v(r,e,n),$(e,t)},p:L,i:L,o:L,d(r){r&&p(e)}}}function ie(u){let e,t,r,n,l,i;return t=new qe({props:{variant:"outlined",padded:!0,$$slots:{default:[Ne]},$$scope:{ctx:u}}}),n=new Ee({props:{$$slots:{default:[Le]},$$scope:{ctx:u}}}),{c(){e=y("div"),R(t.$$.fragment),r=q(),R(n.$$.fragment),l=q(),this.h()},l(a){e=Q(a,"DIV",{class:!0});var s=I(e);D(t.$$.fragment,s),r=A(s),D(n.$$.fragment,s),l=A(s),s.forEach(p),this.h()},h(){w(e,"class","space-y-2")},m(a,s){v(a,e,s),P(t,e,null),$(e,r),P(n,e,null),$(e,l),i=!0},p(a,s){const o={};s&32769&&(o.$$scope={dirty:s,ctx:a}),t.$set(o);const c={};s&32771&&(c.$$scope={dirty:s,ctx:a}),n.$set(c)},i(a){i||(b(t.$$.fragment,a),b(n.$$.fragment,a),i=!0)},o(a){k(t.$$.fragment,a),k(n.$$.fragment,a),i=!1},d(a){a&&p(e),H(t),H(n)}}}function Pe(u){let e;return{c(){e=E("Priimti")},l(t){e=C(t,"Priimti")},m(t,r){v(t,e,r)},d(t){t&&p(e)}}}function He(u){let e;return{c(){e=E("Atmesti")},l(t){e=C(t,"Atmesti")},m(t,r){v(t,e,r)},d(t){t&&p(e)}}}function Ue(u){let e,t,r,n,l=u[9].rentee+"",i,a,s,o,c,_=u[9].itemName+"",f,d,h,O,B,T,M,U,W,N,j;t=new fe({props:{class:"w-6 h-6"}});function Y(){return u[6](u[9])}U=new re({props:{class:"w-full",onClick:Y,$$slots:{default:[Pe]},$$scope:{ctx:u}}});function Z(){return u[7](u[9])}return N=new re({props:{class:"w-full",onClick:Z,$$slots:{default:[He]},$$scope:{ctx:u}}}),{c(){e=y("div"),R(t.$$.fragment),r=q(),n=y("span"),i=E(l),a=E(" nori nuomuotis:"),s=q(),o=y("div"),c=y("p"),f=E(_),d=q(),h=y("div"),O=y("img"),T=q(),M=y("div"),R(U.$$.fragment),W=q(),R(N.$$.fragment),this.h()},l(m){e=Q(m,"DIV",{class:!0});var g=I(e);D(t.$$.fragment,g),r=A(g),n=Q(g,"SPAN",{});var K=I(n);i=C(K,l),a=C(K," nori nuomuotis:"),K.forEach(p),g.forEach(p),s=A(m),o=Q(m,"DIV",{class:!0});var V=I(o);c=Q(V,"P",{class:!0});var x=I(c);f=C(x,_),x.forEach(p),d=A(V),h=Q(V,"DIV",{class:!0});var ee=I(h);O=Q(ee,"IMG",{class:!0,src:!0,alt:!0}),ee.forEach(p),V.forEach(p),T=A(m),M=Q(m,"DIV",{class:!0});var z=I(M);D(U.$$.fragment,z),W=A(z),D(N.$$.fragment,z),z.forEach(p),this.h()},h(){w(e,"class","flex gap-2 text-xl border-b pb-4"),w(c,"class","text-lg text-gray-700"),w(O,"class","w-40 aspect-square rounded"),te(O.src,B=u[9].image_url)||w(O,"src",B),w(O,"alt","product"),w(h,"class","inline-block border p-4"),w(o,"class","space-y-4"),w(M,"class","flex gap-16 border-t pt-4")},m(m,g){v(m,e,g),P(t,e,null),$(e,r),$(e,n),$(n,i),$(n,a),v(m,s,g),v(m,o,g),$(o,c),$(c,f),$(o,d),$(o,h),$(h,O),v(m,T,g),v(m,M,g),P(U,M,null),$(M,W),P(N,M,null),j=!0},p(m,g){u=m,(!j||g&1)&&l!==(l=u[9].rentee+"")&&F(i,l),(!j||g&1)&&_!==(_=u[9].itemName+"")&&F(f,_),(!j||g&1&&!te(O.src,B=u[9].image_url))&&w(O,"src",B);const K={};g&1&&(K.onClick=Y),g&32768&&(K.$$scope={dirty:g,ctx:u}),U.$set(K);const V={};g&1&&(V.onClick=Z),g&32768&&(V.$$scope={dirty:g,ctx:u}),N.$set(V)},i(m){j||(b(t.$$.fragment,m),b(U.$$.fragment,m),b(N.$$.fragment,m),j=!0)},o(m){k(t.$$.fragment,m),k(U.$$.fragment,m),k(N.$$.fragment,m),j=!1},d(m){m&&p(e),H(t),m&&p(s),m&&p(o),m&&p(T),m&&p(M),H(U),H(N)}}}function Ne(u){let e,t;return e=new ce({props:{class:"flex flex-col gap-4",$$slots:{default:[Ue]},$$scope:{ctx:u}}}),{c(){R(e.$$.fragment)},l(r){D(e.$$.fragment,r)},m(r,n){P(e,r,n),t=!0},p(r,n){const l={};n&32769&&(l.$$scope={dirty:n,ctx:r}),e.$set(l)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Ve(u){let e,t=u[9].rentee+"",r;return{c(){e=E("Atsiliepimai apie "),r=E(t)},l(n){e=C(n,"Atsiliepimai apie "),r=C(n,t)},m(n,l){v(n,e,l),v(n,r,l)},p(n,l){l&1&&t!==(t=n[9].rentee+"")&&F(r,t)},d(n){n&&p(e),n&&p(r)}}}function Se(u){let e;return{c(){e=E("Kraunama...")},l(t){e=C(t,"Kraunama...")},m(t,r){v(t,e,r)},p:L,i:L,o:L,d(t){t&&p(e)}}}function je(u){let e,t,r,n=u[1][u[9].rentee].data.reviews.length===0&&ae(),l=u[1][u[9].rentee].data.reviews,i=[];for(let s=0;s<l.length;s+=1)i[s]=oe(le(u,l,s));const a=s=>k(i[s],1,1,()=>{i[s]=null});return{c(){n&&n.c(),e=q();for(let s=0;s<i.length;s+=1)i[s].c();t=S()},l(s){n&&n.l(s),e=A(s);for(let o=0;o<i.length;o+=1)i[o].l(s);t=S()},m(s,o){n&&n.m(s,o),v(s,e,o);for(let c=0;c<i.length;c+=1)i[c].m(s,o);v(s,t,o),r=!0},p(s,o){if(s[1][s[9].rentee].data.reviews.length===0?n||(n=ae(),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null),o&3){l=s[1][s[9].rentee].data.reviews;let c;for(c=0;c<l.length;c+=1){const _=le(s,l,c);i[c]?(i[c].p(_,o),b(i[c],1)):(i[c]=oe(_),i[c].c(),b(i[c],1),i[c].m(t.parentNode,t))}for(J(),c=l.length;c<i.length;c+=1)a(c);G()}},i(s){if(!r){for(let o=0;o<l.length;o+=1)b(i[o]);r=!0}},o(s){i=i.filter(Boolean);for(let o=0;o<i.length;o+=1)k(i[o]);r=!1},d(s){n&&n.d(s),s&&p(e),ve(i,s),s&&p(t)}}}function ae(u){let e;return{c(){e=E("Atsiliepim\u0173 apie \u0161\u012F vartotoj\u0105 n\u0117ra.")},l(t){e=C(t,"Atsiliepim\u0173 apie \u0161\u012F vartotoj\u0105 n\u0117ra.")},m(t,r){v(t,e,r)},d(t){t&&p(e)}}}function oe(u){let e,t,r,n,l=u[12].fk_reviewer+"",i,a,s,o=u[12].review+"",c,_,f;return r=new fe({props:{class:"w-6 h-6"}}),{c(){e=y("div"),t=y("div"),R(r.$$.fragment),n=q(),i=E(l),a=E(":"),s=q(),c=E(o),_=q(),this.h()},l(d){e=Q(d,"DIV",{class:!0});var h=I(e);t=Q(h,"DIV",{class:!0});var O=I(t);D(r.$$.fragment,O),n=A(O),i=C(O,l),a=C(O,":"),O.forEach(p),s=A(h),c=C(h,o),_=A(h),h.forEach(p),this.h()},h(){w(t,"class","flex gap-2"),w(e,"class","flex items-center gap-8")},m(d,h){v(d,e,h),$(e,t),P(r,t,null),$(t,n),$(t,i),$(t,a),$(e,s),$(e,c),$(e,_),f=!0},p(d,h){(!f||h&3)&&l!==(l=d[12].fk_reviewer+"")&&F(i,l),(!f||h&3)&&o!==(o=d[12].review+"")&&F(c,o)},i(d){f||(b(r.$$.fragment,d),f=!0)},o(d){k(r.$$.fragment,d),f=!1},d(d){d&&p(e),H(r)}}}function Ke(u){let e,t,r,n;const l=[je,Se],i=[];function a(s,o){return s[1][s[9].rentee]&&s[1][s[9].rentee].status==="success"?0:1}return e=a(u),t=i[e]=l[e](u),{c(){t.c(),r=S()},l(s){t.l(s),r=S()},m(s,o){i[e].m(s,o),v(s,r,o),n=!0},p(s,o){let c=e;e=a(s),e===c?i[e].p(s,o):(J(),k(i[c],1,1,()=>{i[c]=null}),G(),t=i[e],t?t.p(s,o):(t=i[e]=l[e](s),t.c()),b(t,1),t.m(r.parentNode,r))},i(s){n||(b(t),n=!0)},o(s){k(t),n=!1},d(s){i[e].d(s),s&&p(r)}}}function Be(u){let e,t,r,n;return e=new Ie({props:{$$slots:{default:[Ve]},$$scope:{ctx:u}}}),r=new ce({props:{$$slots:{default:[Ke]},$$scope:{ctx:u}}}),{c(){R(e.$$.fragment),t=q(),R(r.$$.fragment)},l(l){D(e.$$.fragment,l),t=A(l),D(r.$$.fragment,l)},m(l,i){P(e,l,i),v(l,t,i),P(r,l,i),n=!0},p(l,i){const a={};i&32769&&(a.$$scope={dirty:i,ctx:l}),e.$set(a);const s={};i&32771&&(s.$$scope={dirty:i,ctx:l}),r.$set(s)},i(l){n||(b(e.$$.fragment,l),b(r.$$.fragment,l),n=!0)},o(l){k(e.$$.fragment,l),k(r.$$.fragment,l),n=!1},d(l){H(e,l),l&&p(t),H(r,l)}}}function Le(u){let e,t;return e=new Ce({props:{color:"secondary",$$slots:{default:[Be]},$$scope:{ctx:u}}}),{c(){R(e.$$.fragment)},l(r){D(e.$$.fragment,r)},m(r,n){P(e,r,n),t=!0},p(r,n){const l={};n&32771&&(l.$$scope={dirty:n,ctx:r}),e.$set(l)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function ue(u,e){let t,r,n,l=e[9].status==="pending"&&ie(e);return{key:u,first:null,c(){t=S(),l&&l.c(),r=S(),this.h()},l(i){t=S(),l&&l.l(i),r=S(),this.h()},h(){this.first=t},m(i,a){v(i,t,a),l&&l.m(i,a),v(i,r,a),n=!0},p(i,a){e=i,e[9].status==="pending"?l?(l.p(e,a),a&1&&b(l,1)):(l=ie(e),l.c(),b(l,1),l.m(r.parentNode,r)):l&&(J(),k(l,1,1,()=>{l=null}),G())},i(i){n||(b(l),n=!0)},o(i){k(l),n=!1},d(i){i&&p(t),l&&l.d(i),i&&p(r)}}}function Te(u){let e,t,r,n,l,i,a,s;const o=[De,Re],c=[];function _(f,d){return d&1&&(l=null),l==null&&(l=f[0].filter(Fe).length===0),l?0:1}return i=_(u,-1),a=c[i]=o[i](u),{c(){e=y("div"),t=y("h1"),r=E("U\u017Esakymai:"),n=q(),a.c(),this.h()},l(f){e=Q(f,"DIV",{});var d=I(e);t=Q(d,"H1",{class:!0});var h=I(t);r=C(h,"U\u017Esakymai:"),h.forEach(p),n=A(d),a.l(d),d.forEach(p),this.h()},h(){w(t,"class","text-lg mb-4")},m(f,d){v(f,e,d),$(e,t),$(t,r),$(e,n),c[i].m(e,null),s=!0},p(f,[d]){let h=i;i=_(f,d),i===h?c[i].p(f,d):(J(),k(c[h],1,1,()=>{c[h]=null}),G(),a=c[i],a?a.p(f,d):(a=c[i]=o[i](f),a.c()),b(a,1),a.m(e,null))},i(f){s||(b(a),s=!0)},o(f){k(a),s=!1},d(f){f&&p(e),c[i].d()}}}const Fe=u=>u.status==="pending";function Ge(u,e,t){let r,{data:n}=e,l=n.requests;const i=ye.uniq(l,!1,f=>f.rentee).map(f=>f.rentee),a=Me(i.map(f=>({queryKey:[f,"Reviews"],queryFn:()=>fetch(`/api/db/reviews?${Qe.stringify({user:f})}`).then(d=>d.json())})));_e(u,a,f=>t(5,r=f));const s={};async function o(f,d,h,O,B){return(await fetch("/api/db/requests",{method:"PUT",body:JSON.stringify({requestId:f,action:d,itemId:h,renter:O,rentee:B})})).ok?(setTimeout(()=>{t(0,l=l.filter(M=>M.id!=f))},3e3),{state:"success",text:d==="accept"?"Priimta!":"Atmesta!"}):{state:"error",text:"Klaida!"}}const c=f=>o(f.id,"accept",f.itemId,f.renter,f.rentee),_=f=>o(f.id,"refuse",f.itemId,f.renter,f.rentee);return u.$$set=f=>{"data"in f&&t(4,n=f.data)},u.$$.update=()=>{if(u.$$.dirty&32)for(let f=0;f<i.length;++f)t(1,s[i[f]]=r[f],s)},[l,s,a,o,n,r,c,_]}class rt extends pe{constructor(e){super(),de(this,e,Ge,Te,me,{data:4})}}export{rt as default};
